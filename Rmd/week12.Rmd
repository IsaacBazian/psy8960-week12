---
title: "PSY 8960 Week 12"
author: "Isaac Bazian"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


## Script Settings and Resources
```{r script_settings_and_resources}
#setwd(dirname(rstudioapi::getActiveDocumentContext()$path)) comment for now, probably won't need
library(tidyverse)
library(jsonlite)
library(tm)
library(qdap)
library(textstem)
```

## Data Import and Cleaning

THIS IS NOT WHAT IS NEEDED ON THE FINAL ASSIGNMENT. This grabs 100 or so posts from the subreddit, not the past year. Will need to figure out how to do that and download the data later, but this is enough to get started on the rest of the code and I will just change how I get week12_tbl later.
```{r data_import_and_cleaning}
riopsychology_list <- fromJSON("https://www.reddit.com/r/IOPsychology/.json?limit=100", flatten = TRUE)
week12_tbl_original <- as_tibble(riopsychology_list$data$children)
week12_tbl <- week12_tbl_original %>%
  select(title = data.title,
         upvotes = data.score)
```



## Analysis

```{r analysis}
week12_tbl_pre_preprocess <- week12_tbl %>% 
  mutate(across("title", str_replace_all, "-|/", " ")) #This is done because otherwise words connected by a hyphen or slash end up as one word with removePunctuation

io_corpus_original <- VCorpus(VectorSource(week12_tbl_pre_preprocess$title))
io_corpus_preprocessed <- io_corpus_original %>% 
  tm_map(content_transformer(replace_abbreviation)) %>% 
  tm_map(content_transformer(replace_contraction)) %>% 
  tm_map(content_transformer(replace_symbol)) %>% #Dollar symbol came up
  tm_map(content_transformer(str_to_lower)) %>% 
  tm_map(content_transformer(replace_number)) %>%
  tm_map(removePunctuation) %>% 
  tm_map(removeWords, c(stopwords("en"), "io", "i o", "io psychology", "i o psychology", "io psych", "i o psych", "riopsychology", "iopsychology")) %>% 
  tm_map(stripWhitespace) %>% 
  tm_map(content_transformer(lemmatize_strings))

content(io_corpus_original[[1]])
content(io_corpus_preprocessed[[1]])
```


```{r compare_them}
compare_them <- function(corp1, corp2) {
  rows <- 1:length(corp1)
  pick <- sample(rows, 1)
  corp_list <- list("Original" = content(corp1[[pick]]), "Preprocessed" = content(corp2[[pick]]))
  return(corp_list)
}

compare_them(io_corpus_original, io_corpus_preprocessed)
```







